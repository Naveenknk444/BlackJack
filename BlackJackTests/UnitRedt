using Moq;
using Xunit;
using YourNamespace;  // Replace with actual namespace
using System.Threading.Tasks;
using System.Collections.Generic;

public class HallexDataMigratorSourceTests
{
    private readonly Mock<IService> _mockService;  // Mocking the service that HallexDataMigratorSource depends on
    private readonly HallexDataMigratorSource _hallexDataMigratorSource;

    public HallexDataMigratorSourceTests()
    {
        // Initialize the mock service
        _mockService = new Mock<IService>();
        
        // Initialize the class under test (HallexDataMigratorSource)
        _hallexDataMigratorSource = new HallexDataMigratorSource(_mockService.Object);
    }

    [Fact]
    public async Task Extract_ShouldReturnData_WhenValidIdIsPassed()
    {
        // Arrange: Mock the Extract method behavior
        var expectedData = new HallexRecordNew { Id = 1, Name = "TestRecord" };
        _mockService.Setup(service => service.Extract(It.IsAny<int>())).ReturnsAsync(expectedData);

        // Act: Call the Extract method
        var result = await _hallexDataMigratorSource.Extract(1);

        // Assert: Verify the result using Assert.That
        Assert.That(result, Is.Not.Null);
        Assert.That(result.Name, Is.EqualTo("TestRecord"));
    }

    [Fact]
    public async Task Extract_ShouldReturnNull_WhenInvalidIdIsPassed()
    {
        // Arrange: Mock the Extract method behavior to return null
        _mockService.Setup(service => service.Extract(It.IsAny<int>())).ReturnsAsync((HallexRecordNew)null);

        // Act: Call the Extract method with an invalid ID
        var result = await _hallexDataMigratorSource.Extract(999);

        // Assert: Verify that result is null using Assert.That
        Assert.That(result, Is.Null);
    }

    [Fact]
    public async Task ExtractAll_ShouldReturnData_WhenDataIsAvailable()
    {
        // Arrange: Mock the ExtractAll method to return a list of records
        var expectedRecords = new List<HallexRecordNew>
        {
            new HallexRecordNew { Id = 1, Name = "Record 1" },
            new HallexRecordNew { Id = 2, Name = "Record 2" }
        };
        _mockService.Setup(service => service.ExtractAll()).ReturnsAsync(expectedRecords);

        // Act: Call the ExtractAll method
        var result = await _hallexDataMigratorSource.ExtractAll();

        // Assert: Verify that the list contains the expected records using Assert.That
        Assert.That(result, Is.Not.Null);
        Assert.That(result.Count, Is.EqualTo(2));
        Assert.That(result[0].Name, Is.EqualTo("Record 1"));
    }

    [Fact]
    public async Task ExtractAll_ShouldReturnEmptyList_WhenNoDataIsAvailable()
    {
        // Arrange: Mock the ExtractAll method to return an empty list
        _mockService.Setup(service => service.ExtractAll()).ReturnsAsync(new List<HallexRecordNew>());

        // Act: Call the ExtractAll method
        var result = await _hallexDataMigratorSource.ExtractAll();

        // Assert: Verify that the list is empty using Assert.That
        Assert.That(result, Is.Not.Null);
        Assert.That(result.Count, Is.EqualTo(0));
    }
}
